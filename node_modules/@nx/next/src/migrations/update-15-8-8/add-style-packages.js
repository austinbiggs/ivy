"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.update = void 0;
const devkit_1 = require("@nx/devkit");
async function update(tree) {
    const projects = (0, devkit_1.getProjects)(tree);
    const missingDeps = {};
    for (const [, config] of projects) {
        if (config.targets?.build?.executor === '@nrwl/next:build' &&
            tree.exists((0, devkit_1.joinPathFragments)(config.root, 'next.config.js'))) {
            const nextConfigContent = tree.read((0, devkit_1.joinPathFragments)(config.root, 'next.config.js'), 'utf-8');
            if (nextConfigContent.includes('@nrwl/next/plugins/with-less')) {
                missingDeps['less'] = '3.12.2';
            }
            if (nextConfigContent.includes('@nrwl/next/plugins/with-stylus')) {
                missingDeps['stylus'] = '^0.55.0';
            }
        }
    }
    return (0, devkit_1.addDependenciesToPackageJson)(tree, {}, missingDeps);
}
exports.update = update;
exports.default = update;
